%% insettings.tex
%% Copyright 2019 Marei Peischl
\ProvidesFile{insettings.tex}[2019/12/22 Konfigurationsdatei kivitendo ERP]
% Sprachüberprüfung
\RequirePackage[english, ngerman]{babel}
\Ifstr{\lxlangcode}{EN}{
	\makeatletter
	\main@language{english}
	\makeatother
	\input{english.tex}}{
	\Ifstr{\lxlangcode}{DE}{
		\makeatletter
		\main@language{ngerman}
		\makeatother
		\input{deutsch.tex}}{\input{deutsch.tex}}
} % Ende EN


% Mandanten-/Firmenabhängigkeiten

% Pfad zu firmenspez. Angaben, sofern kein Unterordner mit dem Datenbanknamen des Mandanten in der Vorlage existiert, wird der Unterordner „firma“ verwendet. Der Datenbankname ist ab hier im Makro \identpath gespeichert
\setupIdentpath{\kivicompany}

% Lade die Konfiguration aus dem entsprechenden Unterordner
\input{\identpath/ident.tex}


%Setze Briefkopf-logo falls vorhanden
\setkomavar{fromlogo}{\includegraphics[width=.25\linewidth]{\identpath/briefkopf}}

%Ganzseitiger Briefbogen als Hintergrund:
%\DeclareNewLayer[page,background,
%	contents={\includegraphics{Briefbogen}} %Hier muss der Dateinamen und ggf. die Bildgröße angepasst werden, falls es abweichende Maße vom Papierformat hat.
%]{background}
%\AddLayersToPageStyle{kivitendo.letter.first}{background}%Hintergrund für die erste Seite aktivieren
%\AddLayersToPageStyle{kivitendo.letter}{background}% Hintergrund für die übrigen Briefseiten aktivieren.


% Währungen/Konten
% Die Konfiguration bedindet sich in der Datei 
% \identpath/<euro/chf/usd/default>_account.tex
\setupCurrencyConfig{\identpath}{\lxcurrency}


% Befehl f. normale Schriftart und -größe

\KOMAoptions{
	fontsize=10pt,
	parskip=half-,% Absatzkennzeichnung durch Abstand statt Einzug
}
\renewcommand*{\familydefault}{\sfdefault}
\KOMAoptions{fontsize=10pt}

% Einstellungen f. Kopf und Fuss
\pagestyle{kivitendo.letter}
% Befehl f. laufende Kopfzeile:
% 1. Text f. Kunden- oder Lieferantennummer (oder leer, wenn diese nicht ausgegeben werden soll)
% 2. Kunden- oder Lieferantennummer (oder leer)
% 3. Belegname {oder leer}
% 4. Belegnummer {oder leer}
% 5. Belegdatum {oder leer}
% Beispiel: \ourhead{\kundennummer}{<%customernumber%>}{\angebot}{<%quonumber%>}{<%quodate%>}
\setkomafont{pagehead}{\scriptsize}
\newcommand{\ourhead}[5] {
\chead{
  \ifnum\thepage=1
  \else
      \makebox[\textwidth]{
      \Ifstr{#1}{}{}{#1: #2 \hspace{0.7cm}}
      #3
      \Ifstr{#4}{}{}{~\nr: #4}
      \Ifstr{#5}{}{}{\vom ~ #5}
      \hspace{0.7cm} - \seite ~ \thepage/\letterlastpage  ~-%
      }
  \fi
}
}


\normalfont % damit die footerbox schon in der standard-schriftart gebaut wird.
%% % Firmenfuss
% Das speichern als Box ermöglicht es, die Höhe automatisch anzupassen:
\setkomafont{pagefoot}{\tiny}

%Box generieren, um die Höhe des Fußres zu kennen
\newsavebox\footerbox
\begin{lrbox}\footerbox
	\usekomafont{pagefoot}%
     \begin{tabular*}{\textwidth}{@{\extracolsep{\fill}}p{5cm}p{4.5cm}lr@{}}%
	\firma                 & \email              & \textKontonummer & \kontonummer \\
	\strasse               & \homepage           & \textBank        & \bank \\
	\ort                   & \textUstid\ \ustid  & \textIban        & \iban \\
	\textTelefon~\telefon  & \finanzamt          & \textBic         & \bic \\
	\Ifstr{\fax}{}{}{\textFax~\fax} & &\textBankleitzahl	& \bankleitzahl
	\end{tabular*}
\end{lrbox}

%Fußhöhe auf Höhe der Box
\setlength{\footheight}{\dimexpr\ht\footerbox+\dp\footerbox}
\geometry{bottom=\dimexpr\csname g_kivi_margin_dim\endcsname +\footheight}
\savegeometry{kivi.letter@default}

%Box in den Fuß eintragen:
\cfoot{\usebox\footerbox}

\endinput
